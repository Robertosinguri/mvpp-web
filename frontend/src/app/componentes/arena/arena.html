<background></background>
<div class="arena-container">
  <header class="arena-header">
    <div class="arena-info">
      <h1>Arena {{nombreJugador}}</h1>
      <div class="batalla-info">
        <span class="sala-code">Sala: {{roomCode}}</span>
        <span class="batalla-temas">{{getTematicasTexto()}}</span>
        <span class="dificultad dif-{{dificultad}}">{{dificultad}}</span>
      </div>
    </div>
    
    <div class="arena-stats">
      <div class="pregunta-counter">
        <span>{{preguntaActual + 1}}/{{totalPreguntas}}</span>
      </div>
      <div class="puntaje">
        <span>Puntos: {{puntaje}}</span>
      </div>
      <div class="timer" [class.warning]="tiempoRestante <= 5">
        <span>⏱️ {{tiempoRestante}}s</span>
      </div>
    </div>
  </header>

  <!-- Estado de carga -->
  <div class="loading-state" *ngIf="estadoJuego === 'cargando'">
    <div class="loading-content">
      <div class="spinner-arena"></div>
      <h2>Preparando la Arena...</h2>
      <p>Mezclando preguntas de todos los jugadores</p>
      <div class="tematicas-loading">
        <span *ngFor="let tematica of tematicas" class="tematica-chip">
          {{tematica}}
        </span>
      </div>
    </div>
  </div>

  <!-- Arena activa -->
  <main class="arena-main" *ngIf="estadoJuego === 'jugando'">
    <div class="battle-section">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progreso"></div>
      </div>

      <div class="question-card">
        <!-- Indicador de temática -->
        <div class="question-source" *ngIf="preguntaActualObj">
          <span class="source-badge">{{preguntaActualObj.tematica}}</span>
          <span class="contributed-by" *ngIf="preguntaActualObj.aportadoPor">
            Aportada por {{preguntaActualObj.aportadoPor}}
          </span>
        </div>

        <h2 class="question-text">{{preguntaActual + 1}}. {{preguntaActualObj?.pregunta}}</h2>
        
        <div class="options-grid">
          <button 
            class="option-btn arena-option"
            *ngFor="let opcion of preguntaActualObj?.opciones; let i = index"
            [class.selected]="respuestaSeleccionada === i"
            [class.correct]="mostrarRespuesta && i === preguntaActualObj?.respuestaCorrecta"
            [class.incorrect]="mostrarRespuesta && respuestaSeleccionada === i && i !== preguntaActualObj?.respuestaCorrecta"
            [disabled]="mostrarRespuesta"
            (click)="seleccionarRespuesta(i)">
            <span class="option-letter">{{getLetraOpcion(i)}}</span>
            <span class="option-text">{{opcion}}</span>
          </button>
        </div>

        <div class="question-actions" *ngIf="!mostrarRespuesta">
          <button 
            class="confirm-btn arena-confirm" 
            [disabled]="respuestaSeleccionada === null"
            (click)="confirmarRespuesta()">
            ⚡ Confirmar Respuesta
          </button>
        </div>

        <div class="answer-feedback" *ngIf="mostrarRespuesta">
          <div class="feedback-content arena-feedback" [class.correct]="respuestaCorrecta" [class.incorrect]="!respuestaCorrecta">
            <h3>{{respuestaCorrecta ? '¡Correcto! 🎯' : 'Incorrecto ❌'}}</h3>
            <p *ngIf="!respuestaCorrecta && preguntaActualObj">
              La respuesta correcta era: <strong>{{preguntaActualObj.opciones[preguntaActualObj.respuestaCorrecta]}}</strong>
            </p>
          </div>
          
          <button class="next-btn arena-next" (click)="siguientePregunta()">
            {{esUltimaPregunta() ? '🏆 Ver Resultados' : '➡️ Siguiente Pregunta'}}
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Botón de salida -->
  <div class="arena-controls">
    <button class="exit-btn" (click)="salirArena()">
      🚪 Salir de la Arena
    </button>
  </div>
</div>