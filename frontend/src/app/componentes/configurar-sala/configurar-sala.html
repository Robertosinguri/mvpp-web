<background></background>
<div class="config-container">
  <header class="config-header">
    <h1>{{esHost ? 'Configurar Sala' : 'Generar Preguntas'}}</h1>
    <button class="back-btn" (click)="volver()">â† Volver</button>
  </header>

  <main class="config-main">
    <div class="config-form">
      <div class="form-section">
        <h2>Tu Aporte al Cuestionario</h2>
        <p>Comparte tu conocimiento: elige un tema donde seas experto y desafÃ­a a los demÃ¡s</p>

        <div class="input-group">
          <label>Tu TemÃ¡tica de Expertise</label>
          <p class="help-text">MÃ¡ximo 3 palabras (ej: alta cocina, servicios nube, rolling stones)</p>
          <input 
            type="text" 
            placeholder="Escribe tu temÃ¡tica..." 
            [(ngModel)]="configuracion.tematica"
            (input)="validarTematica($event)"
            class="tematica-input"
            [class.error]="tematicaInvalida"
            maxlength="50">
          
          <div class="validation-message" *ngIf="tematicaInvalida">
            âš ï¸ Solo se permiten mÃ¡ximo 3 palabras para generar preguntas precisas
          </div>
          
          <div class="word-counter">
            Palabras: {{contarPalabras(configuracion.tematica)}}/3
          </div>
          
          <div class="suggestions" *ngIf="!configuracion.tematica">
            <span class="suggestions-label">ğŸ’¡ Sugerencias:</span>
            <div class="suggestion-tags">
              <button 
                type="button"
                class="suggestion-tag" 
                *ngFor="let sugerencia of sugerenciasTematicas"
                (click)="seleccionarSugerencia(sugerencia)">
                {{sugerencia}}
              </button>
            </div>
          </div>
        </div>

        <div class="input-group">
          <label>Dificultad</label>
          <div class="difficulty-options">
            <button 
              class="difficulty-btn"
              [class.active]="configuracion.dificultad === 'baby'"
              (click)="configuracion.dificultad = 'baby'">
              ğŸ¼ Baby
            </button>
            <button 
              class="difficulty-btn"
              [class.active]="configuracion.dificultad === 'conocedor'"
              (click)="configuracion.dificultad = 'conocedor'">
              ğŸ§  Conocedor
            </button>
            <button 
              class="difficulty-btn"
              [class.active]="configuracion.dificultad === 'killer'"
              (click)="configuracion.dificultad = 'killer'">
              ğŸ’€ Killer
            </button>
          </div>
        </div>

        <div class="input-group" *ngIf="esHost">
          <label>NÃºmero de Jugadores</label>
          <div class="player-options">
            <button 
              class="player-btn"
              [class.active]="configuracion.jugadores === 2"
              (click)="configuracion.jugadores = 2">
              2 Jugadores
            </button>
            <button 
              class="player-btn"
              [class.active]="configuracion.jugadores === 3"
              (click)="configuracion.jugadores = 3">
              3 Jugadores
            </button>
            <button 
              class="player-btn"
              [class.active]="configuracion.jugadores === 4"
              (click)="configuracion.jugadores = 4">
              4 Jugadores
            </button>
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button 
          class="create-btn" 
          [disabled]="!esConfiguracionValida() || isLoading"
          (click)="crearSala()" 
          *ngIf="esHost && !infoSalaExistente">
          {{isLoading ? 'Iniciando...' : 'Iniciar Sala'}}
        </button>
        <button 
          class="ready-btn" 
          [disabled]="!esConfiguracionValida() || isLoading"
          (click)="confirmarConfiguracion()" 
          *ngIf="!esHost">
          {{isLoading ? 'UniÃ©ndose...' : 'Listo'}}
        </button>
      </div>
    </div>

    <!-- Panel para HOST -->
    <div class="info-panel" *ngIf="esHost">
      <!-- InformaciÃ³n sutil antes de crear la sala -->
      <div class="pre-creation-info" *ngIf="!infoSalaExistente">
        <div class="info-note">
          ğŸ’¡ Al crear la sala obtendrÃ¡s un cÃ³digo para invitar amigos
        </div>
      </div>
      
      <!-- Solo mostrar cÃ³digo despuÃ©s de crear la sala -->
      <div class="room-code-section" *ngIf="codigoSala && infoSalaExistente">
        <h3>ğŸ® CÃ³digo de Sala</h3>
        <div class="code-display">
          <span class="room-code">{{codigoSala}}</span>
          <button class="copy-btn" 
                  [class.copied]="copiado" 
                  (click)="copiarCodigo()" 
                  title="Copiar cÃ³digo">
            {{copiado ? 'âœ“' : 'ğŸ“‹'}}
          </button>
        </div>
        <p class="share-text">Comparte este cÃ³digo con tus amigos</p>
      </div>
      
      <div class="game-info">
        <h4>InformaciÃ³n del Juego</h4>
        <div class="info-item">
          <span class="label">Preguntas totales:</span>
          <span class="value">5 preguntas</span>
        </div>
        <div class="info-item">
          <span class="label">DistribuciÃ³n:</span>
          <span class="value">{{getDistribucionPreguntas()}}</span>
        </div>
      </div>

      <!-- Lista de jugadores en tiempo real -->
      <div class="players-section" *ngIf="infoSalaExistente">
        <h4>Jugadores ({{infoSalaExistente.jugadoresActuales}}/{{infoSalaExistente.maxJugadores}})</h4>
        <div class="players-list">
          <div class="player-card" *ngFor="let jugador of infoSalaExistente.jugadores">
            <div class="player-name">
              {{jugador.nombre}}
              <span class="host-badge" *ngIf="jugador.esHost">ğŸ‘‘</span>
            </div>
            <div class="player-status" [class.configured]="jugador.tematica && jugador.dificultad">
              <span *ngIf="jugador.tematica && jugador.dificultad">âœ… Listo</span>
              <span *ngIf="!jugador.tematica || !jugador.dificultad">â³ Configurando...</span>
            </div>
          </div>
        </div>
        
        <!-- BotÃ³n "Iniciar Juego" movido al Lobby -->
        <div class="info-message">
          ğŸ¯ Una vez que todos estÃ©n listos, irÃ¡n al lobby para iniciar la partida
        </div>
      </div>
    </div>

    <!-- Panel para INVITADO -->
    <div class="sala-info-panel" *ngIf="!esHost && infoSalaExistente">
      <div class="room-header">
        <h3>ğŸ® Sala: {{infoSalaExistente.codigo}}</h3>
        <div class="host-info">
          <span>ğŸ‘‘ Host: {{infoSalaExistente.host}}</span>
        </div>
      </div>

      <div class="players-section">
        <h4>Jugadores ({{infoSalaExistente.jugadoresActuales}}/{{infoSalaExistente.maxJugadores}})</h4>
        
        <div class="players-list">
          <div class="player-card" *ngFor="let jugador of infoSalaExistente.jugadores">
            <div class="player-name">
              {{jugador.nombre}}
              <span class="host-badge" *ngIf="jugador.esHost">ğŸ‘‘</span>
            </div>
            <div class="player-config">
              <span class="tema" *ngIf="jugador.tematica">{{jugador.tematica}}</span>
              <span class="dificultad" *ngIf="jugador.dificultad">{{jugador.dificultad}}</span>
              <span class="status" [class.ready]="jugador.tematica && jugador.dificultad">
                {{(jugador.tematica && jugador.dificultad) ? 'âœ… Listo' : 'â³ Configurando...'}}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="game-preview">
        <h4>ğŸ¯ InformaciÃ³n del Juego</h4>
        <div class="preview-item">
          <span class="label">Preguntas totales:</span>
          <span class="value">5</span>
        </div>
        <div class="preview-item">
          <span class="label">TemÃ¡ticas configuradas:</span>
          <div class="temas-actuales">
            <span class="tema-tag" *ngFor="let jugador of infoSalaExistente.jugadores" 
                  [class.configured]="jugador.tematica">
              {{jugador.tematica || jugador.nombre + ' (pendiente)'}}
            </span>
          </div>
        </div>
        
        <div class="info-message">
          ğŸ¯ Una vez configurado, irÃ¡s al lobby donde el host puede iniciar la partida
        </div>
      </div>
    </div>
  </main>
</div>